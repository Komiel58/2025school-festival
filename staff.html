<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>スタッフ画面</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDK -->
  https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js
  https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyClT68mSngMVqcfTg3XncGqlHB9BRyB4PA",
      authDomain: "school-festival-1daf0.firebaseapp.com",
      projectId: "school-festival-1daf0",
      storageBucket: "school-festival-1daf0.appspot.com",
      messagingSenderId: "1001219715401",
      appId: "1:1001219715401:web:32abdb07bf06e38519ea98",
      measurementId: "G-J9SZ0N4BT6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body>
  <h1>注文履歴</h1>
  <div id="receivedOrders"></div>
  <h2 id="totalPrice">合計金額: ¥0</h2>

  <script>
    async function displayReceivedOrders() {
      const container = document.getElementById("receivedOrders");
      container.innerHTML = "";
      let total = 0;
      try {
        const snapshot = await db.collection("orders").orderBy("timestamp").get();
        snapshot.forEach(doc => {
          const order = doc.data();
          const section = document.createElement("section");
          const header = document.createElement("h3");
          header.textContent = "注文番号: " + order.orderNumber + "（" + order.timestamp + "） " + (order.paid ? "(会計済)" : "(未会計)");
          section.appendChild(header);
          const ul = document.createElement("ul");
          order.items.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item.name + " - ¥" + item.price;
            ul.appendChild(li);
            total += item.price;
          });
          section.appendChild(ul);
          container.appendChild(section);
        });
        document.getElementById("totalPrice").textContent = "合計金額: ¥" + total;
      } catch (error) {
        console.error("注文取得エラー:", error);
      }
    }

    window.onload = () => {
      displayReceivedOrders();
    };
  </script>
</body>
</html>
