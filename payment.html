<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>会計</title>
</head>
<body>
    

   <h1>未会計注文一覧</h1>
    <div id="unpaidOrders"></div>

    <script>
        function loadOrders() {
            const stored = localStorage.getItem("ordersHistory");
            return stored ? JSON.parse(stored) : [];
        }

        function saveOrders(orders) {
            localStorage.setItem("ordersHistory", JSON.stringify(orders));
        }

        function markAsPaid(index) {
            const orders = loadOrders();
            orders[index].paid = true;
            saveOrders(orders);
            displayUnpaidOrders();
        }

        function displayUnpaidOrders() {
            const container = document.getElementById("unpaidOrders");
            const orders = loadOrders();
            container.innerHTML = "";

            orders.forEach((order, index) => {
                if (!order.paid) {
                    const section = document.createElement("section");
                    const header = document.createElement("h3");
                    header.textContent = `注文番号: ${order.orderNumber}（${order.timestamp}）`;
                    section.appendChild(header);

                    const ul = document.createElement("ul");
                    order.items.forEach(item => {
                        const li = document.createElement("li");
                        li.textContent = `${item.name} - ¥${item.price}`;
                        ul.appendChild(li);
                    });
                    section.appendChild(ul);

                    const button = document.createElement("button");
                    button.textContent = "会計する";
                    button.onclick = () => markAsPaid(index);
                    section.appendChild(button);

                    container.appendChild(section);
                }
            });
        }

        window.onload = () => {
            displayUnpaidOrders();
        };
    </script>

</body>
</html>

<!-- 
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>会計処理ページ</title>
  <link rel="stylesheet" href="style.css">


  https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js</script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyClT68mSngMVqcfTg3XncGqlHB9BRyB4PA",
      authDomain: "school-festival-1daf0.firebaseapp.com",
      projectId: "school-festival-1daf0",
      storageBucket: "school-festival-1daf0.appspot.com",
      messagingSenderId: "1001219715401",
      appId: "1:1001219715401:web:32abdb07bf06e38519ea98",
      measurementId: "G-J9SZ0N4BT6"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

</head>
<body>
  <h1>未会計注文一覧</h1>
  <div id="unpaidOrders"></div>

  <script>
    async function markAsPaid(docId) {
      try {
        await db.collection("orders").doc(docId).update({ paid: true });
        displayUnpaidOrders();
      } catch (error) {
        console.error("会計処理エラー:", error);
      }
    }

    async function displayUnpaidOrders() {
      const container = document.getElementById("unpaidOrders");
      container.innerHTML = "";
      try {
        const snapshot = await db.collection("orders").where("paid", "==", false).orderBy("timestamp").get();
        snapshot.forEach(doc => {
          const order = doc.data();
          const section = document.createElement("section");
          const header = document.createElement("h3");
          header.textContent = "注文番号: " + order.orderNumber + "（" + order.timestamp + "）";
          section.appendChild(header);
          const ul = document.createElement("ul");
          order.items.forEach(item => {
            const li = document.createElement("li");
            li.textContent = item.name + " - ¥" + item.price;
            ul.appendChild(li);
          });
          section.appendChild(ul);
          const button = document.createElement("button");
          button.textContent = "会計する";
          button.onclick = () => markAsPaid(doc.id);
          section.appendChild(button);
          container.appendChild(section);
        });
      } catch (error) {
        console.error("注文取得エラー:", error);
      }
    }

    window.onload = () => {
      displayUnpaidOrders();
    };
  </script>
</body>
</html> -->
